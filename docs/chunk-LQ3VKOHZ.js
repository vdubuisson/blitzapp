import{a as k,b as F}from"./chunk-TK352V5Z.js";import"./chunk-6BMCZC2U.js";import"./chunk-HGFE67KZ.js";import{j as U,k as I,l as G,n as w}from"./chunk-KXDRYK6V.js";import"./chunk-J4OVBQZD.js";import"./chunk-FLJJF36S.js";import{a as V}from"./chunk-BIJCMJ4Z.js";import"./chunk-GLIKPMAE.js";import"./chunk-UR35O2SI.js";import{d as N}from"./chunk-IZXJ5OQA.js";import"./chunk-U4UTBI7T.js";import"./chunk-U2Q7NHL3.js";import"./chunk-AWSUHQ36.js";import"./chunk-ZP7N7TL4.js";import"./chunk-I2GCBKKZ.js";import{Ib as d,Jb as C,Lb as T,Na as s,Nb as A,Ob as L,Pb as O,W as u,Yb as c,_a as b,ba as m,bb as x,ca as p,db as y,kb as P,nb as f,pa as h,pb as D,qb as M,rb as a,sb as r,tb as v,wb as _,yb as g,zb as l}from"./chunk-GNHLBSKU.js";import"./chunk-NWM22BJ3.js";import"./chunk-7CGTOI24.js";var z={CUPIDON:"Tir de Cupidon",VOYANTE:"Vision de la voyante",AMOUREUX:"D\xE9couverte des amoureux",LOUP_GAROU:"Attaque des loups-garous",SORCIERE_HEALTH:"Soin de la sorci\xE8re",SORCIERE_KILL:"Potion de mort de la sorci\xE8re",VILLAGEOIS:"Vote des villageois",CAPITAINE:"Election du capitaine",CHASSEUR:"Tir du chasseur",JOUEUR_FLUTE:"Charme du joueur de fl\xFBte",CHARMED:"D\xE9couverte des charm\xE9s",CORBEAU:"Accusation du corbeau",ENFANT_SAUVAGE:"Mod\xE8le de l'enfant sauvage",SALVATEUR:"Protection du salvateur",GRAND_MECHANT_LOUP:"Attaque du grand m\xE9chant loup",MONTREUR_OURS:"Grognement de l'ours",RENARD:"Reniflement du renard",CHIEN_LOUP:"Choix du chien-loup",SOEURS:"D\xE9couverte des 2 s\u0153urs",FRERES:"D\xE9couverte des 3 fr\xE8res",LOUP_BLANC:"Attaque du loup blanc",VOLEUR:"Echange du voleur",BOUC:"Choix des votants du bouc \xE9missaire",SECTAIRE:"D\xE9finition des groupes",PERE_LOUPS:"Infection par le p\xE8re des loups"};var E=class n{transform(e){return z[e]}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275pipe=x({name:"roundName",type:n,pure:!0})}};var H=()=>[],W=(n,e)=>e.id;function $(n,e){n&1&&(a(0,"span"),d(1,"Avant-partie"),r())}function J(n,e){if(n&1&&(a(0,"span",7),d(1),r(),d(2),a(3,"span",7),d(4),r()),n&2){let t=l(),o=l();s(),C(t.isDuringDay?"\u2600\uFE0F":"\u{1F319}"),s(),T(" ",t.isDuringDay?"Jour":"Nuit"," ",o.dayCount()," "),s(2),C(t.isDuringDay?"\u2600\uFE0F":"\u{1F319}")}}function K(n,e){if(n&1){let t=_();a(0,"lgmj-player",8),g("checkedChange",function(i){let S=m(t).$implicit,B=l(2);return p(B.onPlayerChecked(S.id,i))})("roleChange",function(i){m(t);let S=l(2);return p(S.onRoleSelect(i))}),r()}if(n&2){let t=e.$implicit,o=l(),i=l();P("player",t)("displayMode",i.playerDisplayMode()===i.PlayerDisplayModeEnum.EDIT_ROLE&&!o.selectablePlayers.includes(t.id)?i.PlayerDisplayModeEnum.DEFAULT:i.playerDisplayMode())("disabled",!o.selectablePlayers.includes(t.id))("checked",i.playerDisplayMode()===i.PlayerDisplayModeEnum.SELECT_MULTI?i.selectedPlayers().has(t.id):i.selectedPlayer()===t.id)("noSelfRole",!0)("selectableRoles",o.selectableRoles||A(6,H))}}function X(n,e){if(n&1){let t=_();a(0,"button",9),g("click",function(){m(t);let i=l(2);return p(i.onEquality())}),d(1,"EGALITE"),r()}}function Y(n,e){if(n&1){let t=_();a(0,"header")(1,"div",0),y(2,$,2,0,"span")(3,J,5,4),r(),v(4,"hr"),a(5,"div",1),d(6),L(7,"roundName"),r()(),a(8,"main",2),D(9,K,1,7,"lgmj-player",3,W),r(),a(11,"section",4)(12,"button",5),g("click",function(){m(t);let i=l();return p(i.onSubmit())}),d(13," VALIDER "),r(),y(14,X,2,0,"button",6),r()}if(n&2){let t=l();s(2),f(t.isBeforeGame()?2:3),s(4),C(O(7,4,e.round)),s(3),M(t.players()),s(3),P("disabled",t.submitDisabled()),s(2),f(t.displayEqualityButton()?14:-1)}}var R=class n{constructor(){this.gameService=u(w);this.players=u(U).state.asReadonly();this.roundConfig=u(I).state.asReadonly();this.dayCount=u(G).state.asReadonly();this.playerDisplayMode=c(()=>{let e=this.roundConfig();return e!==null?e.type===3?3:e.maxSelectable>1?2:e.maxSelectable===1?1:0:0});this.selectedPlayer=h(void 0);this.selectedPlayers=c(()=>{let e=this.playersMultiSelectionChange()?.source?.selected??[];return new Set(e)});this.selectedRole=h(void 0);this.playersMultiSelection=new V(!0);this.playersMultiSelectionChange=N(this.playersMultiSelection.changed);this.submitDisabled=c(()=>{switch(this.playerDisplayMode()){case 1:return(this.roundConfig()?.minSelectable??0)>0&&this.selectedPlayer()===void 0;case 2:return this.selectedPlayers().size>(this.roundConfig()?.maxSelectable??0)||this.selectedPlayers().size<(this.roundConfig()?.minSelectable??0);case 3:return(this.roundConfig()?.minSelectable??0)>0&&this.selectedRole()===void 0;default:return!1}});this.displayEqualityButton=c(()=>this.players().some(e=>e.role==="BOUC"&&!e.isDead)&&this.roundConfig()?.round==="VILLAGEOIS");this.isBeforeGame=c(()=>this.roundConfig()?.round==="SECTAIRE");this.PlayerDisplayModeEnum=k}onPlayerChecked(e,t){this.playerDisplayMode()===2?this.playersMultiSelection.toggle(e):this.selectedPlayer.set(t?e:void 0)}onRoleSelect(e){this.selectedRole.set(e)}onSubmit(){let e=this.selectedPlayer()!==void 0?[this.selectedPlayer()]:Array.from(this.selectedPlayers());this.gameService.submitRoundAction(e,this.selectedRole()),this.cleanSelection()}onEquality(){this.gameService.submitRoundAction([],void 0,!0),this.cleanSelection()}cleanSelection(){this.selectedPlayer.set(void 0),this.playersMultiSelection.clear(),this.selectedRole.set(void 0)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=b({type:n,selectors:[["lgmj-game"]],decls:1,vars:1,consts:[[1,"round-subtitle"],[1,"round-title"],[1,"player-list"],[3,"player","displayMode","disabled","checked","noSelfRole","selectableRoles"],[1,"submit-block"],[1,"btn","success",3,"click","disabled"],[1,"btn","warning"],[1,"day-icon"],[3,"checkedChange","roleChange","player","displayMode","disabled","checked","noSelfRole","selectableRoles"],[1,"btn","warning",3,"click"]],template:function(t,o){if(t&1&&y(0,Y,15,6),t&2){let i;f((i=o.roundConfig())?0:-1,i)}},dependencies:[E,F],styles:["header[_ngcontent-%COMP%]{align-items:center;background-color:#fff;display:flex;flex-direction:column;padding:var(--spacing-1);position:sticky;top:var(--header-height);z-index:1}header[_ngcontent-%COMP%]   .round-subtitle[_ngcontent-%COMP%]{font-size:var(--font-size-m);font-weight:var(--font-weight-light);text-transform:uppercase}header[_ngcontent-%COMP%]   .round-subtitle[_ngcontent-%COMP%]   .day-icon[_ngcontent-%COMP%]{font-size:var(--font-size-xl)}header[_ngcontent-%COMP%]   .round-title[_ngcontent-%COMP%]{font-size:var(--font-size-l);text-align:center;text-transform:uppercase}header[_ngcontent-%COMP%]   hr[_ngcontent-%COMP%]{width:15%}"],changeDetection:0})}};export{R as default};
