import{b as v}from"./chunk-SVH4EUKY.js";import"./chunk-IK3VN6WQ.js";import"./chunk-KGFMD6BK.js";import{a as S}from"./chunk-7BENRNQN.js";import"./chunk-REGEYB5P.js";import"./chunk-J6VYBOVG.js";import"./chunk-SCEWJJJJ.js";import"./chunk-2MS6TCI3.js";import{b}from"./chunk-EFH6HX73.js";import"./chunk-ZM6HYW2V.js";import"./chunk-F5TIAXDW.js";import"./chunk-6TFKRWKD.js";import{e as C}from"./chunk-J6W7A42Q.js";import{Ab as y,Qa as u,Ra as _,Sa as m,Ta as i,Ua as n,V as s,Z as g,_ as E,_a as P,ab as p,cb as d,pa as c,pb as R,ya as h}from"./chunk-FDHCW5RC.js";import"./chunk-HMLYRQFI.js";import"./chunk-2NFLSA4Y.js";var G=["VILLAGEOIS","LOUP_GAROU","SOEUR","FRERE"];var N=(o,a)=>a.id;function L(o,a){if(o&1){let e=P();i(0,"lgmj-player-card",5),p("roleChange",function(l){let r=g(e).$implicit,O=d();return E(O.changeRole(r.id,l))}),n()}if(o&2){let e=a.$implicit,t=d();m("player",e)("displayMode",t.playerDisplayMode)("selectableRoles",t.availableRoles())}}var f=class o{newGameCreator=s(S);cardChoiceState=s(b).state.asReadonly();players=this.newGameCreator.currentPlayers;playerDisplayMode=3;canCreate=y(()=>this.canCreateGame(this.players()));availableRoles=y(()=>this.getAvailableRoles(this.players()));changeRole(a,e){this.newGameCreator.changeRole(a,e),this.availableRoles().length===1&&this.affectLastRoleToPlayers()}createGame(){this.newGameCreator.createGame()}getAvailableRoles(a){let e=this.cardChoiceState(),t=new Set(a.map(r=>r.role)),l=Array.from(e.selectedRoles).filter(r=>G.includes(r)||!t.has(r));return e.villageois>a.filter(r=>r.role==="VILLAGEOIS").length&&l.push("VILLAGEOIS"),e.loupGarou>a.filter(r=>r.role==="LOUP_GAROU").length&&l.push("LOUP_GAROU"),t.has("SOEUR")&&a.filter(r=>r.role==="SOEUR").length===2&&(l=l.filter(r=>r!=="SOEUR")),t.has("FRERE")&&a.filter(r=>r.role==="FRERE").length===3&&(l=l.filter(r=>r!=="FRERE")),l}canCreateGame(a){let e=a.every(t=>t.role!=="NOT_SELECTED");return e&&a.some(t=>t.role==="SOEUR")&&(e=a.filter(t=>t.role==="SOEUR").length===2),e&&a.some(t=>t.role==="FRERE")&&(e=a.filter(t=>t.role==="FRERE").length===3),e}affectLastRoleToPlayers(){let a=this.availableRoles()[0];this.players().filter(e=>e.role==="NOT_SELECTED").forEach(e=>this.newGameCreator.changeRole(e.id,a))}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=h({type:o,selectors:[["lgmj-new-game-players-roles-page"]],decls:8,vars:1,consts:[[1,"player-list"],[3,"player","displayMode","selectableRoles"],[1,"submit-block"],[1,"btn","primary",3,"click","disabled"],["routerLink","../players",1,"btn","danger"],[3,"roleChange","player","displayMode","selectableRoles"]],template:function(e,t){e&1&&(i(0,"main",0),u(1,L,1,3,"lgmj-player-card",1,N),n(),i(3,"section",2)(4,"button",3),p("click",function(){return t.createGame()}),R(5," D\xC9MARRER "),n(),i(6,"button",4),R(7,"RETOUR"),n()()),e&2&&(c(),_(t.players()),c(3),m("disabled",!t.canCreate()))},dependencies:[C,v],encapsulation:2,changeDetection:0})};export{f as default};
