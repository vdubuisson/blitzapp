import{b as C}from"./chunk-TK352V5Z.js";import"./chunk-6BMCZC2U.js";import"./chunk-HGFE67KZ.js";import{a as b}from"./chunk-D4LCJG5C.js";import"./chunk-KXDRYK6V.js";import"./chunk-J4OVBQZD.js";import"./chunk-FLJJF36S.js";import"./chunk-UR35O2SI.js";import{b as P}from"./chunk-IZXJ5OQA.js";import"./chunk-U4UTBI7T.js";import"./chunk-U2Q7NHL3.js";import"./chunk-AWSUHQ36.js";import{e as v}from"./chunk-ZP7N7TL4.js";import"./chunk-I2GCBKKZ.js";import{Ib as d,Na as c,W as s,Yb as f,_a as h,ba as y,ca as g,kb as m,pb as u,qb as S,rb as i,sb as n,wb as _,yb as p,zb as R}from"./chunk-GNHLBSKU.js";import"./chunk-NWM22BJ3.js";import"./chunk-7CGTOI24.js";var G=["VILLAGEOIS","LOUP_GAROU","SOEUR","FRERE"];var L=(o,t)=>t.id;function N(o,t){if(o&1){let e=_();i(0,"lgmj-player",5),p("roleChange",function(r){let l=y(e).$implicit,O=R();return g(O.changeRole(l.id,r))}),n()}if(o&2){let e=t.$implicit,a=R();m("player",e)("displayMode",a.playerDisplayMode)("selectableRoles",a.availableRoles())}}var E=class o{constructor(){this.newGameService=s(b);this.cardChoiceState=s(P).state.asReadonly();this.players=this.newGameService.currentPlayers;this.playerDisplayMode=3;this.canCreate=f(()=>this.canCreateGame(this.players()));this.availableRoles=f(()=>this.getAvailableRoles(this.players()))}changeRole(t,e){this.newGameService.changeRole(t,e),this.availableRoles().length===1&&this.affectLastRoleToPlayers()}createGame(){this.newGameService.createGame()}getAvailableRoles(t){let e=this.cardChoiceState(),a=new Set(t.map(l=>l.role)),r=Array.from(e.selectedRoles).filter(l=>G.includes(l)||!a.has(l));return e.villageois>t.filter(l=>l.role==="VILLAGEOIS").length&&r.push("VILLAGEOIS"),e.loupGarou>t.filter(l=>l.role==="LOUP_GAROU").length&&r.push("LOUP_GAROU"),a.has("SOEUR")&&t.filter(l=>l.role==="SOEUR").length===2&&(r=r.filter(l=>l!=="SOEUR")),a.has("FRERE")&&t.filter(l=>l.role==="FRERE").length===3&&(r=r.filter(l=>l!=="FRERE")),r}canCreateGame(t){let e=t.every(a=>a.role!=="NOT_SELECTED");return e&&t.some(a=>a.role==="SOEUR")&&(e=t.filter(a=>a.role==="SOEUR").length===2),e&&t.some(a=>a.role==="FRERE")&&(e=t.filter(a=>a.role==="FRERE").length===3),e}affectLastRoleToPlayers(){let t=this.availableRoles()[0];this.players().filter(e=>e.role==="NOT_SELECTED").forEach(e=>this.newGameService.changeRole(e.id,t))}static{this.\u0275fac=function(e){return new(e||o)}}static{this.\u0275cmp=h({type:o,selectors:[["lgmj-new-game-roles"]],decls:8,vars:1,consts:[[1,"player-list"],[3,"player","displayMode","selectableRoles"],[1,"submit-block"],[1,"btn","primary",3,"click","disabled"],["routerLink","/new-game",1,"btn","danger"],[3,"roleChange","player","displayMode","selectableRoles"]],template:function(e,a){e&1&&(i(0,"main",0),u(1,N,1,3,"lgmj-player",1,L),n(),i(3,"section",2)(4,"button",3),p("click",function(){return a.createGame()}),d(5," D\xC9MARRER "),n(),i(6,"button",4),d(7,"RETOUR"),n()()),e&2&&(c(),S(a.players()),c(3),m("disabled",!a.canCreate()))},dependencies:[v,C],encapsulation:2,changeDetection:0})}};export{E as default};
