import{a as V}from"./chunk-H7XIX35G.js";import"./chunk-4JLUOYQS.js";import{a as k,b as F}from"./chunk-SVH4EUKY.js";import"./chunk-IK3VN6WQ.js";import"./chunk-KGFMD6BK.js";import{j as U,k as I,l as N,n as w}from"./chunk-REGEYB5P.js";import"./chunk-J6VYBOVG.js";import"./chunk-SCEWJJJJ.js";import"./chunk-2MS6TCI3.js";import{d as G}from"./chunk-EFH6HX73.js";import"./chunk-ZM6HYW2V.js";import"./chunk-F5TIAXDW.js";import"./chunk-6TFKRWKD.js";import"./chunk-J6W7A42Q.js";import{Ab as c,Ba as D,Na as y,Oa as g,Qa as x,Ra as M,Sa as P,Ta as a,Ua as o,V as u,Va as v,Z as m,_ as p,_a as f,ab as C,cb as l,ea as S,pa as d,pb as s,qb as _,sb as T,ub as O,vb as A,wb as L,ya as b}from"./chunk-FDHCW5RC.js";import"./chunk-HMLYRQFI.js";import"./chunk-2NFLSA4Y.js";var B={CUPIDON:"Tir de Cupidon",VOYANTE:"Vision de la voyante",AMOUREUX:"D\xE9couverte des amoureux",LOUP_GAROU:"Attaque des loups-garous",SORCIERE_HEALTH:"Soin de la sorci\xE8re",SORCIERE_KILL:"Potion de mort de la sorci\xE8re",VILLAGEOIS:"Vote des villageois",CAPITAINE:"Election du capitaine",CHASSEUR:"Tir du chasseur",JOUEUR_FLUTE:"Charme du joueur de fl\xFBte",CHARMED:"D\xE9couverte des charm\xE9s",CORBEAU:"Accusation du corbeau",ENFANT_SAUVAGE:"Mod\xE8le de l'enfant sauvage",SALVATEUR:"Protection du salvateur",GRAND_MECHANT_LOUP:"Attaque du grand m\xE9chant loup",MONTREUR_OURS:"Grognement de l'ours",RENARD:"Reniflement du renard",CHIEN_LOUP:"Choix du chien-loup",SOEURS:"D\xE9couverte des 2 s\u0153urs",FRERES:"D\xE9couverte des 3 fr\xE8res",LOUP_BLANC:"Attaque du loup blanc",VOLEUR:"Echange du voleur",BOUC:"Choix des votants du bouc \xE9missaire",SECTAIRE:"D\xE9finition des groupes",PERE_LOUPS:"Infection par le p\xE8re des loups"};var E=class n{transform(e){return B[e]}static \u0275fac=function(t){return new(t||n)};static \u0275pipe=D({name:"roundName",type:n,pure:!0})};var H=()=>[],W=(n,e)=>e.id;function $(n,e){n&1&&(a(0,"span"),s(1,"Avant-partie"),o())}function J(n,e){if(n&1&&(a(0,"span",7),s(1),o(),s(2),a(3,"span",7),s(4),o()),n&2){let t=l(),r=l();d(),_(t.isDuringDay?"\u2600\uFE0F":"\u{1F319}"),d(),T(" ",t.isDuringDay?"Jour":"Nuit"," ",r.dayCount()," "),d(2),_(t.isDuringDay?"\u2600\uFE0F":"\u{1F319}")}}function K(n,e){if(n&1){let t=f();a(0,"lgmj-player-card",8),C("checkedChange",function(i){let h=m(t).$implicit,z=l(2);return p(z.onPlayerChecked(h.id,i))})("roleChange",function(i){m(t);let h=l(2);return p(h.onRoleSelect(i))}),o()}if(n&2){let t=e.$implicit,r=l(),i=l();P("player",t)("displayMode",i.playerDisplayMode()===i.PlayerDisplayModeEnum.EDIT_ROLE&&!r.selectablePlayers.includes(t.id)?i.PlayerDisplayModeEnum.DEFAULT:i.playerDisplayMode())("disabled",!r.selectablePlayers.includes(t.id))("checked",i.playerDisplayMode()===i.PlayerDisplayModeEnum.SELECT_MULTI?i.selectedPlayers().has(t.id):i.selectedPlayer()===t.id)("noSelfRole",!0)("selectableRoles",r.selectableRoles||O(6,H))}}function X(n,e){if(n&1){let t=f();a(0,"button",9),C("click",function(){m(t);let i=l(2);return p(i.onEquality())}),s(1,"EGALITE"),o()}}function Y(n,e){if(n&1){let t=f();a(0,"header")(1,"div",0),y(2,$,2,0,"span")(3,J,5,4),o(),v(4,"hr"),a(5,"div",1),s(6),A(7,"roundName"),o()(),a(8,"main",2),x(9,K,1,7,"lgmj-player-card",3,W),o(),a(11,"section",4)(12,"button",5),C("click",function(){m(t);let i=l();return p(i.onSubmit())}),s(13," VALIDER "),o(),y(14,X,2,0,"button",6),o()}if(n&2){let t=l();d(2),g(t.isBeforeGame()?2:3),d(4),_(L(7,4,e.round)),d(3),M(t.players()),d(3),P("disabled",t.submitDisabled()),d(2),g(t.displayEqualityButton()?14:-1)}}var R=class n{gameOrchestrator=u(w);players=u(U).state.asReadonly();roundConfig=u(I).state.asReadonly();dayCount=u(N).state.asReadonly();playerDisplayMode=c(()=>{let e=this.roundConfig();return e!==null?e.type===3?3:e.maxSelectable>1?2:e.maxSelectable===1?1:0:0});selectedPlayer=S(void 0);selectedPlayers=c(()=>{let e=this.playersMultiSelectionChange()?.source?.selected??[];return new Set(e)});selectedRole=S(void 0);playersMultiSelection=new V(!0);playersMultiSelectionChange=G(this.playersMultiSelection.changed);submitDisabled=c(()=>{switch(this.playerDisplayMode()){case 1:return(this.roundConfig()?.minSelectable??0)>0&&this.selectedPlayer()===void 0;case 2:return this.selectedPlayers().size>(this.roundConfig()?.maxSelectable??0)||this.selectedPlayers().size<(this.roundConfig()?.minSelectable??0);case 3:return(this.roundConfig()?.minSelectable??0)>0&&this.selectedRole()===void 0;default:return!1}});displayEqualityButton=c(()=>this.players().some(e=>e.role==="BOUC"&&!e.isDead)&&this.roundConfig()?.round==="VILLAGEOIS");isBeforeGame=c(()=>this.roundConfig()?.round==="SECTAIRE");PlayerDisplayModeEnum=k;onPlayerChecked(e,t){this.playerDisplayMode()===2?this.playersMultiSelection.toggle(e):this.selectedPlayer.set(t?e:void 0)}onRoleSelect(e){this.selectedRole.set(e)}onSubmit(){let e=this.selectedPlayer()!==void 0?[this.selectedPlayer()]:Array.from(this.selectedPlayers());this.gameOrchestrator.submitRoundAction(e,this.selectedRole()),this.cleanSelection()}onEquality(){this.gameOrchestrator.submitRoundAction([],void 0,!0),this.cleanSelection()}cleanSelection(){this.selectedPlayer.set(void 0),this.playersMultiSelection.clear(),this.selectedRole.set(void 0)}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=b({type:n,selectors:[["lgmj-current-game-page"]],decls:1,vars:1,consts:[[1,"round-subtitle"],[1,"round-title"],[1,"player-list"],[3,"player","displayMode","disabled","checked","noSelfRole","selectableRoles"],[1,"submit-block"],[1,"btn","success",3,"click","disabled"],[1,"btn","warning"],[1,"day-icon"],[3,"checkedChange","roleChange","player","displayMode","disabled","checked","noSelfRole","selectableRoles"],[1,"btn","warning",3,"click"]],template:function(t,r){if(t&1&&y(0,Y,15,6),t&2){let i;g((i=r.roundConfig())?0:-1,i)}},dependencies:[F,E],styles:["header[_ngcontent-%COMP%]{align-items:center;background-color:#fff;display:flex;flex-direction:column;padding:var(--spacing-1);position:sticky;top:var(--header-height);z-index:1}header[_ngcontent-%COMP%]   .round-subtitle[_ngcontent-%COMP%]{font-size:var(--font-size-m);font-weight:var(--font-weight-light);text-transform:uppercase}header[_ngcontent-%COMP%]   .round-subtitle[_ngcontent-%COMP%]   .day-icon[_ngcontent-%COMP%]{font-size:var(--font-size-xl)}header[_ngcontent-%COMP%]   .round-title[_ngcontent-%COMP%]{font-size:var(--font-size-l);text-align:center;text-transform:uppercase}header[_ngcontent-%COMP%]   hr[_ngcontent-%COMP%]{width:15%}"],changeDetection:0})};export{R as default};
